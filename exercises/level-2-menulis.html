<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Level 2: Menulis Dasar - Sikabayan</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet"
    />

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="../css/style.css" />

    <style>
      /* Exercise specific styles */
      .exercise-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 2rem;
        min-height: 100vh;
        background: var(--bg);
      }

      .exercise-header {
        text-align: center;
        margin-bottom: 2rem;
        padding: 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .exercise-header h1 {
        color: var(--text-color);
        margin-bottom: 0.5rem;
      }

      .exercise-header h1 span {
        color: var(--primary);
      }

      .level-info {
        display: flex;
        justify-content: center;
        gap: 2rem;
        margin-top: 1rem;
        flex-wrap: wrap;
      }

      .info-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--text-color);
        opacity: 0.8;
      }

      .progress-container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        padding: 1.5rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .progress-bar {
        width: 100%;
        height: 8px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
        overflow: hidden;
        margin-bottom: 0.5rem;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        width: 0%;
        transition: width 0.3s ease;
      }

      .progress-text {
        color: var(--text-color);
        text-align: center;
        font-weight: 600;
      }

      .question-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: none;
      }

      .question-card.active {
        display: block;
        animation: fadeIn 0.3s ease;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .question-number {
        color: var(--primary);
        font-size: 1.1rem;
        font-weight: 600;
        margin-bottom: 1rem;
      }

      .question-text {
        color: var(--text-color);
        font-size: 1.2rem;
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }

      .target-aksara {
        font-size: 6rem;
        text-align: center;
        margin: 2rem 0;
        color: var(--primary);
        font-family: "Times New Roman", serif;
        background: rgba(255, 255, 255, 0.05);
        padding: 2rem;
        border-radius: 0.5rem;
        border: 2px dashed rgba(255, 255, 255, 0.2);
      }

      .writing-area {
        background: rgba(255, 255, 255, 0.05);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 0.5rem;
        padding: 2rem;
        margin: 2rem 0;
        min-height: 200px;
        position: relative;
        overflow: hidden;
      }

      .writing-canvas {
        width: 100%;
        height: 200px;
        border: none;
        background: transparent;
        cursor: crosshair;
      }

      .stroke-guide {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        opacity: 0.3;
      }

      .writing-tools {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1rem;
        flex-wrap: wrap;
      }

      .tool-btn {
        padding: 0.5rem 1rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 0.3rem;
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
      }

      .tool-btn:hover,
      .tool-btn.active {
        border-color: var(--primary);
        background: rgba(32, 147, 164, 0.2);
        color: var(--primary);
      }

      .stroke-order {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
        padding: 1.5rem;
        background: rgba(255, 255, 255, 0.02);
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .stroke-step {
        text-align: center;
        padding: 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 0.3rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .stroke-number {
        color: var(--primary);
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .stroke-char {
        font-size: 2rem;
        color: var(--text-color);
        font-family: "Times New Roman", serif;
      }

      .controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 2rem;
      }

      .btn {
        padding: 0.8rem 2rem;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
      }

      .btn-primary {
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
      }

      .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(32, 147, 164, 0.4);
      }

      .btn-secondary {
        background: rgba(255, 255, 255, 0.1);
        color: var(--text-color);
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .btn-secondary:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      .btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      .feedback {
        margin-top: 1rem;
        padding: 1rem;
        border-radius: 0.5rem;
        display: none;
      }

      .feedback.good {
        background: rgba(16, 185, 129, 0.1);
        border: 1px solid #10b981;
        color: #10b981;
      }

      .feedback.needs-practice {
        background: rgba(251, 191, 36, 0.1);
        border: 1px solid #fbbf24;
        color: #fbbf24;
      }

      .result-screen {
        display: none;
        text-align: center;
      }

      .result-screen.show {
        display: block;
      }

      .score-display {
        font-size: 3rem;
        font-weight: 700;
        color: var(--primary);
        margin: 1rem 0;
      }

      .result-message {
        font-size: 1.2rem;
        color: var(--text-color);
        margin-bottom: 2rem;
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
      }

      .stat-item {
        background: rgba(255, 255, 255, 0.05);
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .stat-number {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 0.5rem;
      }

      .stat-label {
        color: var(--text-color);
        opacity: 0.8;
        font-size: 0.9rem;
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .exercise-container {
          padding: 1rem;
        }

        .level-info {
          gap: 1rem;
        }

        .target-aksara {
          font-size: 4rem;
          padding: 1.5rem;
        }

        .writing-canvas {
          height: 150px;
        }

        .controls {
          flex-direction: column;
          gap: 1rem;
        }

        .stroke-order {
          grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
        }
      }
    </style>
  </head>
  <body>
    <div class="exercise-container">
      <!-- Exercise Header -->
      <div class="exercise-header">
        <h1><span>Level 2:</span> Menulis Dasar Aksara Sunda</h1>
        <p>
          Pelajari cara menulis huruf aksara Sunda dengan stroke order yang
          benar
        </p>
        <div class="level-info">
          <div class="info-item">
            <i data-feather="target"></i>
            <span>Target: 80% untuk lulus</span>
          </div>
          <div class="info-item">
            <i data-feather="clock"></i>
            <span>Waktu: ~20 menit</span>
          </div>
          <div class="info-item">
            <i data-feather="edit-3"></i>
            <span>8 Huruf</span>
          </div>
        </div>
      </div>

      <!-- Progress Bar -->
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text" id="progressText">Huruf 1 dari 8</div>
      </div>

      <!-- Quiz Container -->
      <div id="quizContainer">
        <!-- Questions will be generated by JavaScript -->
      </div>

      <!-- Result Screen -->
      <div class="result-screen" id="resultScreen">
        <div class="question-card">
          <h2>🎉 Level 2 Selesai!</h2>
          <div class="score-display" id="finalScore">88/100</div>
          <div class="result-message" id="resultMessage">
            Bagus! Anda sudah menguasai dasar-dasar menulis aksara Sunda.
          </div>

          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-number" id="goodWriting">6</div>
              <div class="stat-label">Tulisan Baik</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="needsPractice">2</div>
              <div class="stat-label">Perlu Latihan</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="timeTaken">18:45</div>
              <div class="stat-label">Waktu</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="accuracy">88%</div>
              <div class="stat-label">Akurasi</div>
            </div>
          </div>

          <div class="controls">
            <button
              class="btn btn-secondary"
              onclick="window.location.href='../latihan.html'"
            >
              <i data-feather="arrow-left"></i> Kembali ke Menu
            </button>
            <button class="btn btn-primary" onclick="nextLevel()">
              Level Selanjutnya <i data-feather="arrow-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Writing exercises data
      const writingExercises = [
        {
          char: "ᮊ",
          name: "ka",
          instruction:
            "Tulis huruf 'ka' (ᮊ) dengan mengikuti urutan goresan yang benar.",
          strokes: ["ᮊ", "ᮊ", "ᮊ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮘ",
          name: "ba",
          instruction:
            "Tulis huruf 'ba' (ᮘ) dengan hati-hati mengikuti panduan.",
          strokes: ["ᮘ", "ᮘ", "ᮘ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮔ",
          name: "na",
          instruction: "Tulis huruf 'na' (ᮔ) dengan stroke order yang tepat.",
          strokes: ["ᮔ", "ᮔ", "ᮔ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮞ",
          name: "sa",
          instruction: "Tulis huruf 'sa' (ᮞ) dengan bentuk yang proporsional.",
          strokes: ["ᮞ", "ᮞ", "ᮞ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮛ",
          name: "ra",
          instruction: "Tulis huruf 'ra' (ᮛ) dengan lengkungan yang halus.",
          strokes: ["ᮛ", "ᮛ", "ᮛ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮓ",
          name: "da",
          instruction: "Tulis huruf 'da' (ᮓ) dengan garis yang tegas.",
          strokes: ["ᮓ", "ᮓ", "ᮓ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮜ",
          name: "la",
          instruction: "Tulis huruf 'la' (ᮜ) dengan proporsi yang seimbang.",
          strokes: ["ᮜ", "ᮜ", "ᮜ"],
          strokeOrder: [1, 2, 3],
        },
        {
          char: "ᮕ",
          name: "pa",
          instruction: "Tulis huruf 'pa' (ᮕ) dengan bentuk yang rapi.",
          strokes: ["ᮕ", "ᮕ", "ᮕ"],
          strokeOrder: [1, 2, 3],
        },
      ];

      let currentExercise = 0;
      let score = 0;
      let userScores = [];
      let startTime = Date.now();
      let isDrawing = false;
      let currentCanvas = null;
      let currentContext = null;

      function initializeExercise() {
        generateExerciseHTML();
        showExercise(0);
        updateProgress();
      }

      function generateExerciseHTML() {
        const container = document.getElementById("quizContainer");
        container.innerHTML = "";

        writingExercises.forEach((exercise, index) => {
          const exerciseHTML = `
                    <div class="question-card" id="exercise-${index}">
                        <div class="question-number">Latihan ${
                          index + 1
                        } dari ${writingExercises.length}</div>
                        <div class="question-text">${exercise.instruction}</div>
                        
                        <div class="target-aksara">${exercise.char}</div>
                        
                        <div class="stroke-order">
                            <div class="stroke-step">
                                <div class="stroke-number">Urutan Goresan:</div>
                            </div>
                            ${exercise.strokes
                              .map(
                                (stroke, strokeIndex) => `
                                <div class="stroke-step">
                                    <div class="stroke-number">${
                                      strokeIndex + 1
                                    }</div>
                                    <div class="stroke-char">${stroke}</div>
                                </div>
                            `
                              )
                              .join("")}
                        </div>
                        
                        <div class="writing-tools">
                            <button class="tool-btn active" onclick="setPenSize(2)" data-size="2">Tipis</button>
                            <button class="tool-btn" onclick="setPenSize(4)" data-size="4">Sedang</button>
                            <button class="tool-btn" onclick="setPenSize(6)" data-size="6">Tebal</button>
                            <button class="tool-btn" onclick="clearCanvas(${index})">
                                <i data-feather="trash-2"></i> Hapus
                            </button>
                        </div>
                        
                        <div class="writing-area">
                            <canvas class="writing-canvas" id="canvas-${index}"></canvas>
                        </div>
                        
                        <div class="feedback" id="feedback-${index}"></div>
                        
                        <div class="controls">
                            <button class="btn btn-secondary" onclick="previousExercise()" ${
                              index === 0 ? 'style="visibility: hidden"' : ""
                            }>
                                <i data-feather="arrow-left"></i> Sebelumnya
                            </button>
                            <div>
                                <button class="btn btn-secondary" onclick="evaluateWriting(${index})">
                                    <i data-feather="check"></i> Evaluasi
                                </button>
                                <button class="btn btn-primary" id="nextBtn-${index}" onclick="nextExercise()" disabled>
                                    ${
                                      index === writingExercises.length - 1
                                        ? "Selesai"
                                        : "Selanjutnya"
                                    } 
                                    <i data-feather="arrow-right"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
          container.innerHTML += exerciseHTML;
        });

        // Initialize canvases
        writingExercises.forEach((_, index) => {
          setupCanvas(index);
        });
      }

      function setupCanvas(index) {
        const canvas = document.getElementById(`canvas-${index}`);
        const context = canvas.getContext("2d");

        // Set canvas size
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;

        // Set drawing style
        context.strokeStyle = "#20a5b8";
        context.lineWidth = 2;
        context.lineCap = "round";
        context.lineJoin = "round";

        // Add event listeners
        canvas.addEventListener("mousedown", startDrawing);
        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("mouseup", stopDrawing);
        canvas.addEventListener("mouseout", stopDrawing);

        // Touch events for mobile
        canvas.addEventListener("touchstart", handleTouch);
        canvas.addEventListener("touchmove", handleTouch);
        canvas.addEventListener("touchend", stopDrawing);
      }

      function startDrawing(e) {
        isDrawing = true;
        const canvas = e.target;
        const context = canvas.getContext("2d");
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        context.beginPath();
        context.moveTo(x, y);
        currentCanvas = canvas;
        currentContext = context;
      }

      function draw(e) {
        if (!isDrawing || !currentContext) return;

        const rect = currentCanvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;

        currentContext.lineTo(x, y);
        currentContext.stroke();
      }

      function stopDrawing() {
        isDrawing = false;
        currentCanvas = null;
        currentContext = null;
      }

      function handleTouch(e) {
        e.preventDefault();
        const touch = e.touches[0];
        const mouseEvent = new MouseEvent(
          e.type === "touchstart"
            ? "mousedown"
            : e.type === "touchmove"
            ? "mousemove"
            : "mouseup",
          {
            clientX: touch.clientX,
            clientY: touch.clientY,
          }
        );
        e.target.dispatchEvent(mouseEvent);
      }

      function clearCanvas(index) {
        const canvas = document.getElementById(`canvas-${index}`);
        const context = canvas.getContext("2d");
        context.clearRect(0, 0, canvas.width, canvas.height);

        // Hide feedback
        document.getElementById(`feedback-${index}`).style.display = "none";
        document.getElementById(`nextBtn-${index}`).disabled = true;
      }

      function setPenSize(size) {
        // Update all contexts
        writingExercises.forEach((_, index) => {
          const canvas = document.getElementById(`canvas-${index}`);
          const context = canvas.getContext("2d");
          context.lineWidth = size;
        });

        // Update button states
        document.querySelectorAll(".tool-btn[data-size]").forEach((btn) => {
          btn.classList.remove("active");
        });
        document.querySelector(`[data-size="${size}"]`).classList.add("active");
      }

      function evaluateWriting(index) {
        // Simple evaluation - in real app, this would use image recognition
        const canvas = document.getElementById(`canvas-${index}`);
        const context = canvas.getContext("2d");
        const imageData = context.getImageData(
          0,
          0,
          canvas.width,
          canvas.height
        );

        // Check if canvas has content
        let hasContent = false;
        for (let i = 0; i < imageData.data.length; i += 4) {
          if (imageData.data[i + 3] > 0) {
            // Alpha channel
            hasContent = true;
            break;
          }
        }

        if (!hasContent) {
          showFeedback(
            index,
            "needs-practice",
            "Silakan tulis huruf di area yang disediakan."
          );
          return;
        }

        // Simulate evaluation (in real app, this would be AI-powered)
        const accuracy = Math.random() * 30 + 70; // 70-100%
        const exerciseScore = Math.round(accuracy);
        userScores[index] = exerciseScore;

        if (accuracy >= 85) {
          score += 12.5; // 100/8 points per exercise
          showFeedback(
            index,
            "good",
            `Bagus sekali! Tulisan Anda sangat rapi dan mengikuti stroke order dengan benar. (${exerciseScore}%)`
          );
        } else {
          score += (accuracy / 100) * 12.5;
          showFeedback(
            index,
            "needs-practice",
            `Cukup baik, tetapi masih perlu latihan. Perhatikan urutan goresan dan proporsi huruf. (${exerciseScore}%)`
          );
        }

        document.getElementById(`nextBtn-${index}`).disabled = false;
      }

      function showFeedback(index, type, message) {
        const feedback = document.getElementById(`feedback-${index}`);
        feedback.className = `feedback ${type}`;
        feedback.innerHTML = message;
        feedback.style.display = "block";
      }

      function showExercise(index) {
        // Hide all exercises
        document.querySelectorAll(".question-card").forEach((card) => {
          card.classList.remove("active");
        });

        // Show current exercise
        document.getElementById(`exercise-${index}`).classList.add("active");

        // Update progress
        updateProgress();

        // Re-initialize feather icons
        feather.replace();
      }

      function nextExercise() {
        if (currentExercise < writingExercises.length - 1) {
          currentExercise++;
          showExercise(currentExercise);
        } else {
          showResults();
        }
      }

      function previousExercise() {
        if (currentExercise > 0) {
          currentExercise--;
          showExercise(currentExercise);
        }
      }

      function updateProgress() {
        const progress = (currentExercise / writingExercises.length) * 100;
        document.getElementById("progressFill").style.width = progress + "%";
        document.getElementById("progressText").textContent = `Huruf ${
          currentExercise + 1
        } dari ${writingExercises.length}`;
      }

      function showResults() {
        const endTime = Date.now();
        const timeTaken = Math.floor((endTime - startTime) / 1000);
        const minutes = Math.floor(timeTaken / 60);
        const seconds = timeTaken % 60;

        const goodCount = userScores.filter((score) => score >= 85).length;
        const needsPracticeCount = writingExercises.length - goodCount;
        const accuracy = Math.round(score);

        // Hide exercise container
        document.getElementById("quizContainer").style.display = "none";
        document.querySelector(".progress-container").style.display = "none";

        // Show results
        document.getElementById("resultScreen").classList.add("show");
        document.getElementById("finalScore").textContent = accuracy + "/100";
        document.getElementById("goodWriting").textContent = goodCount;
        document.getElementById("needsPractice").textContent =
          needsPracticeCount;
        document.getElementById("timeTaken").textContent = `${minutes}:${seconds
          .toString()
          .padStart(2, "0")}`;
        document.getElementById("accuracy").textContent = accuracy + "%";

        // Update result message
        let message = "";
        if (accuracy >= 90) {
          message =
            "🌟 Luar biasa! Anda sangat menguasai teknik menulis aksara Sunda!";
        } else if (accuracy >= 80) {
          message =
            "👏 Bagus! Anda sudah menguasai dasar-dasar menulis aksara Sunda.";
        } else if (accuracy >= 70) {
          message =
            "👍 Cukup baik! Terus berlatih untuk memperbaiki teknik menulis Anda.";
        } else {
          message =
            "💪 Jangan menyerah! Latihan rutin akan membantu Anda menguasai penulisan aksara Sunda.";
        }

        document.getElementById("resultMessage").textContent = message;

        // Re-initialize feather icons
        feather.replace();
      }

      function nextLevel() {
        window.location.href = "level-3-vokal.html";
      }

      // Initialize exercise when page loads
      document.addEventListener("DOMContentLoaded", function () {
        initializeExercise();
        feather.replace();
      });
    </script>
  </body>
</html>
