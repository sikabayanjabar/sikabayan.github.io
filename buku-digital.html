<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perpustakaan Digital Sunda</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap"
      rel="stylesheet"
    />

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css" />

    <!-- AlpineJS -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>

    <!-- Auth Manager -->
    <script src="js/auth.js"></script>

    <!-- APP -->
    <script src="src/app.js" async></script>

    <style>
      /* Library specific styles */
      .library-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 2rem;
        padding-top: 8rem; /* Space for fixed navbar */
        min-height: 100vh;
        background: var(--bg);
      }

      .library-header {
        text-align: center;
        margin-bottom: 3rem;
        padding: 3rem 2rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1.5rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
      }

      .library-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
      }

      .library-header h1 {
        color: var(--text-color);
        font-size: 2.5rem;
        margin-bottom: 1rem;
        font-weight: 700;
      }

      .library-header h1 span {
        color: var(--primary);
      }

      .library-subtitle {
        color: var(--text-color);
        opacity: 0.9;
        font-size: 1.2rem;
        margin-bottom: 2rem;
      }

      .library-stats {
        display: flex;
        justify-content: center;
        gap: 3rem;
        flex-wrap: wrap;
      }

      .stat-item {
        display: flex;
        align-items: center;
        gap: 0.8rem;
        color: var(--text-color);
        opacity: 0.8;
        font-size: 1.1rem;
      }

      .stat-number {
        color: var(--primary);
        font-weight: 700;
        font-size: 1.3rem;
      }

      /* Search and Filter */
      .search-filter-section {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        padding: 2rem;
        margin-bottom: 2rem;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .search-container {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
        flex-wrap: wrap;
      }

      .search-box {
        flex: 1;
        min-width: 300px;
        position: relative;
        z-index: 10;
      }

      .search-input {
        width: 100%;
        padding: 1rem 1rem 1rem 3rem;
        background: rgba(255, 255, 255, 0.1);
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-radius: 0.8rem;
        color: var(--text-color);
        font-size: 1rem;
        transition: all 0.3s ease;
      }

      .search-input:focus {
        outline: none;
        border-color: var(--primary);
        background: rgba(255, 255, 255, 0.15);
      }

      .search-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-color);
        opacity: 0.6;
      }

      .filter-buttons {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .filter-btn {
        padding: 0.7rem 1.5rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 0.5rem;
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s ease;
        font-size: 0.9rem;
        font-weight: 500;
      }

      .filter-btn:hover,
      .filter-btn.active {
        background: var(--primary);
        border-color: var(--primary);
        color: white;
      }

      /* Books Grid */
      .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
      }

      .book-card {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 1rem;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        transition: all 0.3s ease;
        cursor: pointer;
        position: relative;
      }

      .book-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        border-color: var(--primary);
      }

      /* Light mode styling for book cards */
      [data-theme="light"] .book-card {
        background: rgba(128, 128, 128, 0.15);
        border: 1px solid rgba(128, 128, 128, 0.25);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      }

      [data-theme="light"] .book-card:hover {
        background: rgba(128, 128, 128, 0.2);
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        border-color: var(--primary);
      }

      [data-theme="light"] .book-title {
        color: #1a202c;
      }

      [data-theme="light"] .book-language {
        background: rgba(128, 128, 128, 0.2);
        color: #2d3748;
      }

      [data-theme="light"] .book-category {
        background: rgba(128, 128, 128, 0.2);
        color: #2d3748;
      }

      [data-theme="light"] .btn-download {
        background: rgba(128, 128, 128, 0.15);
        border: 1px solid rgba(128, 128, 128, 0.3);
        color: #2d3748;
      }

      [data-theme="light"] .btn-download:hover {
        background: rgba(128, 128, 128, 0.25);
        border-color: var(--primary);
      }

      .book-cover {
        position: relative;
        height: 250px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
      }

      .book-cover::before {
        content: "";
        position: absolute;
        inset: 0;
        background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="20" cy="20" r="2" fill="rgba(255,255,255,0.1)"/><circle cx="80" cy="40" r="1.5" fill="rgba(255,255,255,0.1)"/><circle cx="40" cy="80" r="1" fill="rgba(255,255,255,0.1)"/></svg>');
        opacity: 0.3;
      }

      .book-icon {
        font-size: 4rem;
        color: white;
        z-index: 1;
        position: relative;
      }

      .book-preview {
        position: absolute;
        inset: 0;
        background: white;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 2;
      }

      .book-preview canvas {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
      }

      .book-info {
        padding: 1.5rem;
      }

      .book-title {
        color: var(--text-color);
        font-size: 1.2rem;
        font-weight: 700;
        margin-bottom: 0.8rem;
        line-height: 1.4;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
      }

      .book-meta {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .book-language {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.3rem 0.8rem;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 1rem;
        font-size: 0.85rem;
        color: var(--text-color);
        opacity: 0.8;
        width: fit-content;
      }

      .book-category {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.3rem 0.8rem;
        background: rgba(32, 147, 164, 0.2);
        border: 1px solid var(--primary);
        border-radius: 1rem;
        font-size: 0.85rem;
        color: var(--primary);
        width: fit-content;
      }

      .book-actions {
        display: flex;
        gap: 0.5rem;
      }

      .btn-read {
        flex: 1;
        padding: 0.8rem 1rem;
        background: var(--primary);
        color: white;
        border: none;
        border-radius: 0.5rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
      }

      .btn-read:hover {
        transform: translateY(-1px);
        background: var(--secondary);
        box-shadow: 0 5px 15px rgba(32, 147, 164, 0.4);
      }

      .btn-download {
        padding: 0.8rem;
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 0.5rem;
        color: var(--text-color);
        cursor: pointer;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .btn-download:hover {
        background: rgba(255, 255, 255, 0.2);
      }

      /* Loading State */
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.8);
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 1000;
      }

      .loading-content {
        background: var(--bg);
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .spinner {
        width: 40px;
        height: 40px;
        border: 3px solid rgba(255, 255, 255, 0.1);
        border-top: 3px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 4rem 2rem;
        color: var(--text-color);
        opacity: 0.6;
      }

      .empty-state i {
        font-size: 4rem;
        margin-bottom: 1rem;
        opacity: 0.5;
      }

      /* Mobile responsiveness */
      @media (max-width: 768px) {
        .library-container {
          padding: 1rem;
          padding-top: 7rem; /* Extra space for mobile navbar */
        }

        .library-header {
          padding: 2rem 1rem;
          margin-bottom: 2rem;
        }

        .library-header h1 {
          font-size: 2rem;
          line-height: 1.2;
        }

        .library-stats {
          gap: 1.5rem;
          flex-wrap: wrap;
        }

        .search-container {
          flex-direction: column;
          gap: 1rem;
          margin-bottom: 1.5rem;
        }

        .search-box {
          min-width: auto;
          width: 100%;
          font-size: 1rem;
          padding: 1rem 1.2rem;
          margin-bottom: 1rem;
        }

        .search-input {
          font-size: 1rem;
          padding: 1rem 1rem 1rem 3rem;
          -webkit-appearance: none;
          appearance: none;
          border-radius: 0.8rem;
        }

        .search-input:focus {
          outline: none;
          border-color: var(--primary);
          box-shadow: 0 0 0 3px rgba(32, 147, 164, 0.1);
        }

        .filter-buttons {
          flex-wrap: wrap;
          gap: 0.5rem;
          justify-content: center;
        }

        .filter-btn {
          padding: 0.6rem 1rem;
          font-size: 0.9rem;
        }

        .books-grid {
          grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
          gap: 1.5rem;
        }

        .book-actions {
          flex-direction: column;
        }
      }

      /* Small mobile responsiveness */
      @media (max-width: 480px) {
        .library-container {
          padding: 0.5rem;
          padding-top: 6.5rem; /* Adjusted for smaller mobile navbar */
        }

        .library-header {
          padding: 1.5rem 0.8rem;
          margin-bottom: 1.5rem;
        }

        .library-header h1 {
          font-size: 1.5rem;
        }

        .library-header p {
          font-size: 0.9rem;
        }

        .search-box {
          padding: 0.8rem 1rem;
          font-size: 0.9rem;
        }

        .search-input {
          padding: 0.8rem 0.8rem 0.8rem 2.5rem;
          font-size: 0.9rem;
        }

        .search-icon {
          left: 0.8rem;
          width: 16px;
          height: 16px;
        }

        .filter-btn {
          padding: 0.5rem 0.8rem;
          font-size: 0.8rem;
        }

        .books-grid {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
          gap: 1rem;
        }

        .book-card {
          margin-bottom: 1rem;
        }

        .book-title {
          font-size: 1rem;
        }

        .btn-read,
        .btn-download {
          padding: 0.6rem 0.8rem;
          font-size: 0.9rem;
        }
      }
    </style>
  </head>
  <body>
    <!-- Nav bar start -->
    <nav class="navbar" x-data>
      <a href="index.html" class="navbar-logo">
        <img
          src="img/logo-sikabayan.png"
          alt="Logo Sikabayan"
          style="height: 50px; margin-right: 10px"
        />
        <span style="color: #2093a4">SIKABAYAN</span>
      </a>

      <div class="navbar-nav">
        <a href="index.html#home">Home</a>
        <a href="index.html#about">Sejarah</a>
        <a href="index.html#menu">Kebijakan</a>
        <a href="index.html#materi">Materi</a>
        <a href="latihan.html">Latihan</a>
        <a href="buku-digital.html">Perpustakaan</a>
        <a href="index.html#contact">Kontak</a>
      </div>

      <div class="navbar-extra">
        <a href="#" id="search-button"><i data-feather="search"></i></a>
        <div class="theme-toggle-container">
          <span class="theme-toggle-label">Dark</span>
          <label class="theme-switch">
            <input type="checkbox" id="theme-toggle" />
            <span class="slider"></span>
          </label>
        </div>
        <a href="login.html" class="login-btn">Login</a>
        <a href="#" id="hamburger-menu"><i data-feather="menu"></i></a>
      </div>

      <!-- Search Form start -->
      <div class="search-form">
        <input type="search" id="search-box" placeholder="search here..." />
        <label for="search-box"><i data-feather="search"></i></label>
        <i data-feather="x" id="close"></i>
      </div>
      <!-- Search Form end -->
    </nav>
    <!-- Navbar end -->

    <div class="library-container">
      <!-- Library Header -->
      <div class="library-header">
        <h1><span>üìö</span> Perpustakaan Digital Sunda</h1>
        <p class="library-subtitle">
          Koleksi cerita dan dongeng dalam aksara Sunda untuk memperkaya
          literasi budaya
        </p>

        <div class="library-stats">
          <div class="stat-item">
            <i data-feather="book"></i>
            <span><span class="stat-number" id="totalBooks">0</span> Buku</span>
          </div>
          <div class="stat-item">
            <i data-feather="globe"></i>
            <span
              ><span class="stat-number" id="languageCount">2</span>
              Bahasa</span
            >
          </div>
          <div class="stat-item">
            <i data-feather="bookmark"></i>
            <span
              ><span class="stat-number" id="categoryCount">3</span>
              Kategori</span
            >
          </div>
        </div>
      </div>

      <!-- Search and Filter -->
      <div class="search-filter-section">
        <div class="search-container">
          <div class="search-box">
            <i data-feather="search" class="search-icon"></i>
            <input
              type="text"
              class="search-input"
              placeholder="Cari judul buku atau cerita..."
              id="searchInput"
            />
          </div>
        </div>

        <div class="filter-buttons">
          <button class="filter-btn active" data-filter="all">
            Semua Buku
          </button>
          <button class="filter-btn" data-filter="sunda">Aksara Sunda</button>
          <button class="filter-btn" data-filter="indonesia">
            Bahasa Indonesia
          </button>
          <button class="filter-btn" data-filter="dongeng">Dongeng</button>
          <button class="filter-btn" data-filter="sejarah">Sejarah</button>
          <button class="filter-btn" data-filter="budaya">Budaya</button>
        </div>
      </div>

      <!-- Books Grid -->
      <div class="books-grid" id="booksGrid">
        <!-- Books will be loaded here -->
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="emptyState" style="display: none">
        <i data-feather="search"></i>
        <h3>Tidak ada buku yang ditemukan</h3>
        <p>Coba ubah kata kunci pencarian atau filter yang dipilih</p>
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
      <div class="loading-content">
        <div class="spinner"></div>
        <p style="color: var(--text-color)">Memuat buku...</p>
      </div>
    </div>

    <script>
      // PDF.js worker
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.10.111/pdf.worker.min.js";

      // Book data - would normally come from a database
      const booksData = [
        {
          filename: "akar nu kuat sunda.pdf",
          title: "Akar Nu Kuat",
          language: "sunda",
          category: "dongeng",
          description:
            "Cerita tentang pentingnya akar yang kuat dalam kehidupan",
        },
        {
          filename: "AKAR YANG KUAT.pdf",
          title: "Akar Yang Kuat",
          language: "indonesia",
          category: "dongeng",
          description:
            "Cerita tentang pentingnya akar yang kuat dalam kehidupan",
        },
        {
          filename: "curug dengdeng indo.pdf",
          title: "Curug Dengdeng",
          language: "indonesia",
          category: "sejarah",
          description: "Legenda air terjun Curug Dengdeng",
        },
        {
          filename: "curug dengdeng sunda - Copy.pdf",
          title: "Curug Dengdeng",
          language: "sunda",
          category: "sejarah",
          description: "Legenda air terjun Curug Dengdeng dalam aksara Sunda",
        },
        {
          filename: "galunggung indo.pdf",
          title: "Gunung Galunggung",
          language: "indonesia",
          category: "sejarah",
          description: "Sejarah dan legenda Gunung Galunggung",
        },
        {
          filename: "galunggung sunda.pdf",
          title: "Gunung Galunggung",
          language: "sunda",
          category: "sejarah",
          description:
            "Sejarah dan legenda Gunung Galunggung dalam aksara Sunda",
        },
        {
          filename: "kampung naga bhs sunda.pdf",
          title: "Kampung Naga",
          language: "sunda",
          category: "budaya",
          description: "Kehidupan dan tradisi Kampung Naga dalam aksara Sunda",
        },
        {
          filename: "kampung naga.pdf",
          title: "Kampung Naga",
          language: "indonesia",
          category: "budaya",
          description: "Kehidupan dan tradisi Kampung Naga",
        },
        {
          filename: "kupu-kupu bordir.pdf",
          title: "Kupu-kupu Bordir",
          language: "indonesia",
          category: "dongeng",
          description: "Cerita tentang kupu-kupu yang pandai membordir",
        },
        {
          filename: "kupu-kupu bordir.sunda.pdf",
          title: "Kupu-kupu Bordir",
          language: "sunda",
          category: "dongeng",
          description:
            "Cerita tentang kupu-kupu yang pandai membordir dalam aksara Sunda",
        },
        {
          filename: "mendong puspa.pdf",
          title: "Mendong Puspa",
          language: "sunda",
          category: "budaya",
          description: "Cerita tentang kerajinan mendong",
        },
        {
          filename: "PAYUNG INEU BHS SUNDA.pdf",
          title: "Payung Ineu",
          language: "sunda",
          category: "dongeng",
          description: "Cerita Payung Ineu dalam aksara Sunda",
        },
        {
          filename: "payung ineu indo.pdf",
          title: "Payung Ineu",
          language: "indonesia",
          category: "dongeng",
          description: "Cerita tradisional Payung Ineu",
        },
        {
          filename: "ranginang sunda - Copy.pdf",
          title: "Ranginang",
          language: "sunda",
          category: "budaya",
          description:
            "Cerita tentang makanan tradisional ranginang dalam aksara Sunda",
        },
        {
          filename: "rennginang indo - Copy.pdf",
          title: "Ranginang",
          language: "indonesia",
          category: "budaya",
          description: "Cerita tentang makanan tradisional ranginang",
        },
        {
          filename: "situ gede bhs indo.pdf",
          title: "Situ Gede",
          language: "indonesia",
          category: "sejarah",
          description: "Legenda Situ Gede dan sejarahnya",
        },
        {
          filename: "situ gede.pdf",
          title: "Situ Gede",
          language: "sunda",
          category: "sejarah",
          description: "Legenda Situ Gede dalam aksara Sunda",
        },
        {
          filename: "tikar mendong indo. sunda.pdf",
          title: "Tikar Mendong",
          language: "sunda",
          category: "budaya",
          description:
            "Cerita tentang kerajinan tikar mendong dalam aksara Sunda",
        },
        {
          filename: "tikar mendong indo.pdf",
          title: "Tikar Mendong",
          language: "indonesia",
          category: "budaya",
          description: "Cerita tentang kerajinan tikar mendong",
        },
        {
          filename: "TO INDO - Copy.pdf",
          title: "TO",
          language: "indonesia",
          category: "dongeng",
          description: "Cerita pendek TO",
        },
        {
          filename: "TOS SUNDA - Copy.pdf",
          title: "TOS",
          language: "sunda",
          category: "dongeng",
          description: "Cerita pendek TOS dalam aksara Sunda",
        },
      ];

      let allBooks = [];
      let filteredBooks = [];

      // Initialize
      document.addEventListener("DOMContentLoaded", function () {
        initializeLibrary();
        setupEventListeners();
        feather.replace();
      });

      function initializeLibrary() {
        allBooks = booksData;
        filteredBooks = [...allBooks];
        updateStats();
        renderBooks();
      }

      function setupEventListeners() {
        // Search functionality
        const searchInput = document.getElementById("searchInput");
        searchInput.addEventListener("input", handleSearch);

        // Filter buttons
        const filterButtons = document.querySelectorAll(".filter-btn");
        filterButtons.forEach((btn) => {
          btn.addEventListener("click", handleFilter);
        });
      }

      function handleSearch(e) {
        const searchTerm = e.target.value.toLowerCase();
        const activeFilter =
          document.querySelector(".filter-btn.active").dataset.filter;

        filteredBooks = allBooks.filter((book) => {
          const matchesSearch =
            book.title.toLowerCase().includes(searchTerm) ||
            book.description.toLowerCase().includes(searchTerm);
          const matchesFilter =
            activeFilter === "all" ||
            book.language === activeFilter ||
            book.category === activeFilter;

          return matchesSearch && matchesFilter;
        });

        renderBooks();
      }

      function handleFilter(e) {
        // Update active filter button
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        e.target.classList.add("active");

        // Apply filter
        const filterValue = e.target.dataset.filter;
        const searchTerm = document
          .getElementById("searchInput")
          .value.toLowerCase();

        filteredBooks = allBooks.filter((book) => {
          const matchesSearch =
            searchTerm === "" ||
            book.title.toLowerCase().includes(searchTerm) ||
            book.description.toLowerCase().includes(searchTerm);
          const matchesFilter =
            filterValue === "all" ||
            book.language === filterValue ||
            book.category === filterValue;

          return matchesSearch && matchesFilter;
        });

        renderBooks();
      }

      function updateStats() {
        const totalBooks = allBooks.length;
        const languages = [...new Set(allBooks.map((book) => book.language))]
          .length;
        const categories = [...new Set(allBooks.map((book) => book.category))]
          .length;

        document.getElementById("totalBooks").textContent = totalBooks;
        document.getElementById("languageCount").textContent = languages;
        document.getElementById("categoryCount").textContent = categories;
      }

      function renderBooks() {
        const booksGrid = document.getElementById("booksGrid");
        const emptyState = document.getElementById("emptyState");

        if (filteredBooks.length === 0) {
          booksGrid.style.display = "none";
          emptyState.style.display = "block";
          return;
        }

        booksGrid.style.display = "grid";
        emptyState.style.display = "none";

        booksGrid.innerHTML = filteredBooks
          .map((book) => createBookCard(book))
          .join("");

        // Re-initialize feather icons
        feather.replace();

        // Load PDF previews
        setTimeout(() => {
          filteredBooks.forEach((book, index) => {
            loadPDFPreview(book.filename, index);
          });
        }, 100);
      }

      function createBookCard(book) {
        const languageIcon = book.language === "sunda" ? "üáÆüá©" : "üåê";
        const categoryIcon = getCategoryIcon(book.category);

        return `
                <div class="book-card" onclick="openBook('${book.filename}', '${
          book.title
        }')">
                    <div class="book-cover">
                        <i data-feather="book-open" class="book-icon"></i>
                        <div class="book-preview" id="preview-${filteredBooks.indexOf(
                          book
                        )}">
                            <canvas id="canvas-${filteredBooks.indexOf(
                              book
                            )}"></canvas>
                        </div>
                    </div>
                    <div class="book-info">
                        <h3 class="book-title">${book.title}</h3>
                        <div class="book-meta">
                            <div class="book-language">
                                <span>${languageIcon}</span>
                                <span>${
                                  book.language === "sunda"
                                    ? "Aksara Sunda"
                                    : "Bahasa Indonesia"
                                }</span>
                            </div>
                            <div class="book-category">
                                <span>${categoryIcon}</span>
                                <span>${capitalizeFirst(book.category)}</span>
                            </div>
                        </div>
                        <div class="book-actions">
                            <button class="btn-read" onclick="event.stopPropagation(); openBook('${
                              book.filename
                            }', '${book.title}')">
                                <i data-feather="book-open"></i>
                                Baca Buku
                            </button>
                            <button class="btn-download" onclick="event.stopPropagation(); downloadBook('${
                              book.filename
                            }', '${book.title}')" title="Unduh PDF">
                                <i data-feather="download"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `;
      }

      function getCategoryIcon(category) {
        const icons = {
          dongeng: "üßö",
          sejarah: "üèõÔ∏è",
          budaya: "üé≠",
        };
        return icons[category] || "üìñ";
      }

      function capitalizeFirst(str) {
        return str.charAt(0).toUpperCase() + str.slice(1);
      }

      async function loadPDFPreview(filename, index) {
        try {
          const url = `materials/story-book/${filename}`;
          const pdf = await pdfjsLib.getDocument(url).promise;
          const page = await pdf.getPage(1);

          const canvas = document.getElementById(`canvas-${index}`);
          if (!canvas) return;

          const context = canvas.getContext("2d");
          const viewport = page.getViewport({ scale: 0.5 });

          canvas.height = viewport.height;
          canvas.width = viewport.width;

          await page.render({
            canvasContext: context,
            viewport: viewport,
          }).promise;

          // Show preview, hide icon
          const preview = document.getElementById(`preview-${index}`);
          const bookIcon = canvas
            .closest(".book-cover")
            .querySelector(".book-icon");

          if (preview && bookIcon) {
            preview.style.display = "flex";
            bookIcon.style.display = "none";
          }
        } catch (error) {
          console.log(`Could not load preview for ${filename}:`, error);
          // Keep the default book icon
        }
      }

      function openBook(filename, title) {
        showLoading();

        // Create URL with parameters for the flipbook viewer
        const viewerUrl = `flipbook-viewer.html?file=${encodeURIComponent(
          filename
        )}&title=${encodeURIComponent(title)}`;

        // Simulate loading time
        setTimeout(() => {
          hideLoading();
          window.open(viewerUrl, "_blank");
        }, 1000);
      }

      function downloadBook(filename, title) {
        const link = document.createElement("a");
        link.href = `materials/story-book/${filename}`;
        link.download = `${title}.pdf`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function showLoading() {
        document.getElementById("loadingOverlay").style.display = "flex";
      }

      function hideLoading() {
        document.getElementById("loadingOverlay").style.display = "none";
      }
    </script>

    <!-- Feather Icons -->
    <script>
      feather.replace();
    </script>

    <!-- Theme Toggle Script -->
    <script>
      // Theme Toggle Functionality
      const themeToggle = document.getElementById("theme-toggle");
      const themeLabel = document.querySelector(".theme-toggle-label");
      const body = document.body;

      // Get saved theme from localStorage or default to 'dark'
      const savedTheme = localStorage.getItem("theme") || "dark";
      body.setAttribute("data-theme", savedTheme);

      // Update toggle state and label based on current theme
      function updateThemeToggle(theme) {
        if (theme === "light") {
          themeToggle.checked = true;
          themeLabel.textContent = "Light";
        } else {
          themeToggle.checked = false;
          themeLabel.textContent = "Dark";
        }
      }

      // Initialize toggle
      updateThemeToggle(savedTheme);

      // Theme toggle event listener
      themeToggle.addEventListener("change", function () {
        const newTheme = this.checked ? "light" : "dark";

        body.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
        updateThemeToggle(newTheme);
      });
    </script>

    <!-- My Javascript -->
    <script src="js/script.js"></script>
  </body>
</html>
